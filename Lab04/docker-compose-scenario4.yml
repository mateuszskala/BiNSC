services:  
  client01:
    image: browsh/browsh:latest
    container_name: mitm_client01
    networks:
      mitm_network:
        ipv4_address: 172.20.0.2
    stdin_open: true
    tty: true
    command: ["--startup-url", "http://172.20.0.4:8080/"]
    shm_size: "1gb"
    
  server01:
    image: nginx:alpine
    container_name: mitm_server01
    networks:
      mitm_network:
        ipv4_address: 172.20.0.4
    volumes:
      - ./server_files:/usr/share/nginx/html:ro
    ports:
      - "8080:80"

  attacker01:
    build:
      context: .
      dockerfile: Dockerfile.advanced_interceptor
    container_name: mitm_attacker01
    networks:
      mitm_network:
        ipv4_address: 172.20.0.3
    volumes:
      - ./intercept_scripts:/workspace
      - ./intercept_logs:/logs
    cap_add:
      - NET_ADMIN
    stdin_open: true
    tty: true

networks:
  mitm_network:
    driver: bridge
    ipam:
      config:
        - subnet: 172.20.0.0/24
